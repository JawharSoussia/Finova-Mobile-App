// const SavingsGoal = require("../models/Budget");
// const User = require("../models/User");
// const { sendEmail } = require("./emailService"); // √Ä impl√©menter

// const processOldestGoal = async () => {
//   try {
//     const nextGoal = await SavingsGoal.findOne({ status: 'pending' })
//       .sort({ priority: -1, createdAt: 1 })
//       .populate('userId');

//     if (!nextGoal) return;

//     const now = new Date();
//     const isAchieved = nextGoal.currentAmount >= nextGoal.targetAmount;
//     const isExpired = now > nextGoal.targetDate;

//     if (isAchieved || isExpired) {
//       console.log(`Processing goal "${nextGoal.name}" (${nextGoal._id})`);
//       console.log(`Status: ${isAchieved ? 'Achieved' : 'Expired'}`);
//       console.log(`Current Amount: ${nextGoal.currentAmount}‚Ç¨ / Target: ${nextGoal.targetAmount}‚Ç¨`);

//       await sendGoalCompletionNotification(nextGoal, isAchieved);

//       const update = { 
//         status: isAchieved ? 'completed' : 'expired',
//         completedAt: new Date()
//       };

//       await SavingsGoal.findByIdAndUpdate(nextGoal._id, update);
//       console.log(`‚úÖ Goal status updated to: ${isAchieved ? 'completed' : 'expired'}`);
//     }
//   } catch (error) {
//     console.error("Error processing goal:", error);
//     throw error;
//   }
// };

// const sendGoalCompletionNotification = async (goal, isAchieved) => {
//   try {
//     const user = await User.findById(goal.userId);
//     if (!user?.email) return;

//     const subject = isAchieved 
//       ? `üéâ Objectif "${goal.name}" atteint !`
//       : `‚ö†Ô∏è Objectif "${goal.name}" expir√©`;

//     const message = isAchieved
//       ? `Vous avez atteint votre objectif d'√©pargne "${goal.name}" (${goal.targetAmount}‚Ç¨).`
//       : `Votre objectif "${goal.name}" n'a pas √©t√© atteint √† temps.`;

//     await sendEmail({
//       to: user.email,
//       subject,
//       html: `<h1>${isAchieved ? 'F√©licitations !' : 'Objectif expir√©'}</h1>
//             <p>${message}</p>`
//     });

//     console.log(`Notification FIFO envoy√©e pour: ${goal._id}`);
//   } catch (error) {
//     console.error("Erreur notification FIFO:", error);
//     throw error;
//   }
// };

// module.exports = { processOldestGoal };